<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GTTS</title>
  <meta name="description" content="GTTS: Vehicle ‚Ä¢ Navigator ‚Ä¢ Tolls ‚Ä¢ Fuel ‚Ä¢ Hotels ‚Ä¢ Nearby" />
  <meta name="color-scheme" content="dark" />

  <style>
    :root{
      --bg:#0b1220;
      --panel:#061024;
      --panel2:#07162d;
      --border:#1f3558;
      --text:#eaf0ff;
      --muted:#9bb2d6;
      --brand1:#35b6ff;
      --brand2:#2b6bff;
      --shadow:0 16px 40px rgba(0,0,0,.35);

      /* refined red on light-blue background, wide border */
      --iconBg:#BFE6FF;
      --iconBorder:#0B2A3D;
      --iconRed1:#B11226;
      --iconRed2:#E11D48;
      --iconRed3:#7F0B1A;
      --iconHi:#FFD1D9;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(53,182,255,.14), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(43,107,255,.16), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    /* ===== Topbar ===== */
    .topbar{
      position:sticky; top:0; z-index:30;
      display:flex; align-items:center; gap:12px;
      padding:12px 14px;
      background:linear-gradient(135deg,var(--brand1),var(--brand2));
      border-bottom:1px solid rgba(255,255,255,.14);
    }
    .iconbtn{
      border:1px solid rgba(255,255,255,.25);
      background:rgba(6,16,36,.25);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:1000;
      box-shadow:0 8px 18px rgba(0,0,0,.18);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .logo{font-weight:1000; letter-spacing:.9px; font-size:20px}
    .subtitle{font-size:12px; opacity:.92}

    .right{margin-left:auto; display:flex; align-items:center; gap:10px}
    .select{
      background:rgba(6,16,36,.30);
      color:var(--text);
      border:1px solid rgba(255,255,255,.25);
      border-radius:12px;
      padding:10px 10px;
      font-weight:900;
      max-width:280px;
      outline:none;
    }
    .btn{
      border:1px solid rgba(255,255,255,.25);
      background:rgba(6,16,36,.25);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:1000;
      box-shadow:0 8px 18px rgba(0,0,0,.12);
    }
    .btnGhost{
      border:1px solid rgba(155,178,214,.35);
      background:transparent;
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:1000;
    }

    /* ===== Layout ===== */
    .main{padding:16px}
    .grid{
      display:grid;
      grid-template-columns: 1.12fr 1fr;
      gap:16px;
      max-width:1200px;
      margin:0 auto;
    }
    .card{
      background:linear-gradient(180deg, rgba(6,16,36,.95), rgba(6,16,36,.78));
      border:1px solid rgba(31,53,88,.8);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(8px);
    }
    .cardHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(31,53,88,.7);
    }
    .cardTitle{font-weight:1000; font-size:16px}
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(155,178,214,.35);
      color:var(--muted);
      font-weight:1000;
      font-size:12px;
      white-space:nowrap;
    }

    .map{
      height:520px;
      background:
        radial-gradient(900px 500px at 20% 20%, rgba(53,182,255,.12), transparent 55%),
        radial-gradient(900px 500px at 80% 35%, rgba(43,107,255,.14), transparent 60%),
        var(--panel2);
      position:relative;
    }
    .mapPlaceholder{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:10px;
      padding:16px;
      text-align:center;
      color:var(--muted);
    }
    .mapBig{font-size:46px}
    .mapText{max-width:560px; line-height:1.4}

    .mapBar{
      display:flex; gap:10px; align-items:center;
      padding:10px 14px;
      border-top:1px solid rgba(31,53,88,.7);
    }
    .small{font-size:12px; color:var(--muted)}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    .view{padding:14px}
    .sectionTitle{font-weight:1000; font-size:18px; margin:0 0 10px}
    .hr{height:1px; background:rgba(31,53,88,.7); margin:14px 0}

    .item{
      border:1px solid rgba(31,53,88,.9);
      border-radius:16px;
      padding:12px;
      background:rgba(6,16,36,.35);
    }
    .itemSub{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .chip{
      border:1px solid rgba(155,178,214,.26);
      color:var(--text);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
    }
    .badge{
      border:1px solid rgba(53,182,255,.5);
      color:#cfefff;
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
      white-space:nowrap;
    }

    /* ===== Fields ===== */
    .field{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:10px;
      align-items:center;
      margin:10px 0;
    }
    .label{color:var(--muted); font-size:12px; font-weight:1000}
    .input{
      width:100%;
      background:rgba(6,16,36,.55);
      color:var(--text);
      border:1px solid rgba(155,178,214,.25);
      border-radius:12px;
      padding:10px 10px;
      font-weight:1000;
      outline:none;
    }
    .input:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.3);
    }
    select.input{appearance:auto}

    .hint{color:var(--muted); font-size:12px; margin-top:8px; line-height:1.35}

    .footer{
      max-width:1200px;
      margin:14px auto 0;
      display:flex; justify-content:space-between;
      gap:12px;
      padding:10px 6px;
      color:var(--muted);
    }

    /* ===== Drawer ===== */
    .drawer{
      position:fixed; top:0; left:0; height:100%;
      width:330px;
      background:rgba(6,16,36,.98);
      border-right:1px solid rgba(31,53,88,.9);
      transform:translateX(-110%);
      transition:transform .2s ease;
      z-index:80;
      display:flex; flex-direction:column;
      backdrop-filter: blur(10px);
    }
    .drawer.open{transform:translateX(0)}
    .drawerHeader{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px;
      border-bottom:1px solid rgba(31,53,88,.7);
    }
    .drawerTitle{font-weight:1000; font-size:18px}
    .nav{padding:12px; display:flex; flex-direction:column; gap:10px}
    .navItem{
      width:100%;
      text-align:left;
      border:1px solid rgba(31,53,88,.95);
      background:rgba(6,16,36,.35);
      color:var(--text);
      border-radius:16px;
      padding:12px;
      cursor:pointer;
      font-weight:1000;
    }
    .navItem.active{border-color: rgba(53,182,255,.85)}
    .drawerFooter{
      margin-top:auto;
      padding:12px 14px;
      border-top:1px solid rgba(31,53,88,.7);
    }
    .backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      z-index:70;
      display:none;
    }
    .backdrop.show{display:block}

    /* ===== Toast ===== */
    .toast{
      position:fixed; left:50%; bottom:18px;
      transform:translateX(-50%);
      background:rgba(6,16,36,.94);
      border:1px solid rgba(155,178,214,.35);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:1000;
      font-size:13px;
      max-width:92vw;
      box-shadow:var(--shadow);
      z-index:9999;
      opacity:0;
      pointer-events:none;
      transition:opacity .15s ease;
    }
    .toast.show{opacity:1}

    /* ===== Custom Select (vehicle + country) ===== */
    .xselect{position:relative}
    .xselectBtn{
      width:100%;
      display:flex; align-items:center; gap:12px;
      background:rgba(6,16,36,.55);
      border:1px solid rgba(155,178,214,.25);
      border-radius:12px;
      padding:10px 10px;
      cursor:pointer;
      color:var(--text);
      font-weight:1000;
    }
    .xselectBtn:focus{outline:2px solid rgba(53,182,255,.5); outline-offset:2px}

    /* 2cm x 2cm ~ 76px @96dpi */
    .thumb{
      width:76px; height:76px; flex:0 0 auto;
      border-radius:16px;
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      border:1px solid rgba(155,178,214,.20);
      background:rgba(255,255,255,.05);
    }
    .thumb svg{width:76px; height:76px; display:block}

    .xtext{display:flex; flex-direction:column; gap:4px; flex:1; min-width:0}
    .xcode{font-size:12px; color:var(--muted); font-weight:1000}
    .xlabel{font-size:13px; font-weight:1000; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .caret{margin-left:auto; color:var(--muted)}

    .xmenu{
      position:absolute; left:0; right:0; top:calc(100% + 8px);
      background:rgba(6,16,36,.98);
      border:1px solid rgba(155,178,214,.25);
      border-radius:14px;
      box-shadow:var(--shadow);
      max-height:420px;
      overflow:auto;
      z-index:999;
      padding:8px;
      display:none;
    }
    .xselect.open .xmenu{display:block}
    .xgroup{
      padding:10px 8px 6px;
      color:var(--muted);
      font-weight:1000;
      font-size:12px;
    }
    .xopt{
      display:flex; align-items:center; gap:12px;
      padding:10px 8px;
      border-radius:14px;
      cursor:pointer;
      border:1px solid transparent;
    }
    .xopt:hover{background:rgba(255,255,255,.06)}
    .xopt.active{border-color:rgba(53,182,255,.55); background:rgba(53,182,255,.08)}
    .xopt .thumb{width:76px; height:76px}

    /* Country flag "waving" thumb */
    .flag{
      width:76px; height:50px;
      border-radius:14px;
      border:5px solid rgba(11,42,61,.95); /* wide frame */
      overflow:hidden;
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      transform: translateZ(0);
    }
    .flag::before{
      content:"";
      position:absolute; inset:-20% -30%;
      background:var(--flagGrad, linear-gradient(90deg,#fff,#ddd));
      transform:skewX(-8deg);
      filter:saturate(1.05);
    }
    .flag::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(24px 18px at 25% 35%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(22px 16px at 65% 55%, rgba(0,0,0,.12), transparent 60%),
        linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,0) 30%, rgba(0,0,0,.10) 60%, rgba(255,255,255,.10));
      animation: wave 2.1s ease-in-out infinite;
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    @keyframes wave{
      0%   { transform: translateX(-6px) translateY(-2px) }
      50%  { transform: translateX(6px) translateY(2px) }
      100% { transform: translateX(-6px) translateY(-2px) }
    }

    /* ===== Trailer toggle ===== */
    .toggleBtn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(155,178,214,.35);
      background:rgba(6,16,36,.35);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
    }
    .toggleDot{
      width:14px; height:14px;
      border-radius:999px;
      border:2px solid rgba(155,178,214,.45);
      background:transparent;
    }
    .toggleBtn.on{
      border-color: rgba(53,182,255,.7);
      background: rgba(53,182,255,.10);
    }
    .toggleBtn.on .toggleDot{
      background: rgba(53,182,255,.9);
      border-color: rgba(53,182,255,.9);
    }

    /* ===== Back to menu button inside pages ===== */
    .backRow{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .backBtn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(155,178,214,.35);
      background:rgba(6,16,36,.20);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      font-weight:1000;
      cursor:pointer;
    }

    /* ===== Responsive ===== */
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .map{height:420px}
      .field{grid-template-columns: 1fr}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <button id="btnMenu" class="iconbtn" aria-label="Open menu">‚ò∞</button>

    <div class="brand">
      <div class="logo">GTTS</div>
      <div class="subtitle" id="subTitle">Vehicle ‚Ä¢ Navigator ‚Ä¢ Tolls ‚Ä¢ Fuel ‚Ä¢ Hotels ‚Ä¢ Nearby</div>
    </div>

    <div class="right">
      <select id="lang" class="select" aria-label="Language"></select>
      <button id="btnLocate" class="btn">üìç <span id="tLocate">–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è</span></button>
    </div>
  </header>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="drawerHeader">
      <div class="drawerTitle">GTTS</div>
      <button id="btnClose" class="iconbtn" aria-label="Close menu">‚úï</button>
    </div>

    <nav class="nav">
      <button class="navItem" data-route="vehicle">üöó <span id="tNavVehicle">–ê–≤—Ç–æ–º–æ–±—ñ–ª—å</span></button>
      <button class="navItem" data-route="navigator">üß≠ <span id="tNavNav">–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä</span></button>
      <button class="navItem" data-route="tolls">üõ£Ô∏è <span id="tNavTolls">–û–ø–ª–∞—Ç–∞ –¥–æ—Ä—ñ–≥</span></button>
      <button class="navItem" data-route="fuel">‚õΩ <span id="tNavFuel">–ó–∞–ø—Ä–∞–≤–∫–∞</span></button>
      <button class="navItem" data-route="hotels">üè® <span id="tNavHotels">–ì–æ—Ç–µ–ª—ñ</span></button>
      <button class="navItem" data-route="nearby">üìå <span id="tNavNearby">–ú—ñ—Å—Ü—è –ø–æ—Ä—É—á</span></button>
    </nav>

    <div class="drawerFooter">
      <div class="small" id="tDrawerNote">MVP –¥–µ–º–æ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö –æ–ø–ª–∞—Ç).</div>
    </div>
  </aside>

  <div id="backdrop" class="backdrop"></div>

  <main class="main">
    <section class="grid">
      <div class="card">
        <div class="cardHeader">
          <div class="cardTitle" id="tMapTitle">–ú–∞–ø–∞</div>
          <div class="pill" id="pillStatus">Demo</div>
        </div>

        <div class="map">
          <div class="mapPlaceholder">
            <div class="mapBig">üó∫Ô∏è</div>
            <div class="mapText" id="tMapPlaceholder">
              –ó–∞–≥–ª—É—à–∫–∞ –º–∞–ø–∏. –ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è‚Äù, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é, —ñ –æ–±–∏—Ä–∞–π –º–æ–¥—É–ª—ñ.
            </div>
          </div>
        </div>

        <div class="mapBar">
          <span class="small" id="tCoordLabel">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</span>
          <span class="mono" id="coord">‚Äî</span>
          <button id="btnShare" class="btnGhost" style="margin-left:auto;">üîó <span id="tShare">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</span></button>
        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          <div class="cardTitle" id="viewTitle">‚Äî</div>
          <div class="pill" id="viewPill">MVP</div>
        </div>
        <div id="view" class="view"></div>
      </div>
    </section>

    <footer class="footer">
      <div>¬© 2026 GTTS</div>
      <div class="small" id="tDisclaimer">–ü—Ä–æ—Ç–æ—Ç–∏–ø. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö –æ–ø–ª–∞—Ç.</div>
    </footer>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    (function(){
      "use strict";

      /* ========= helpers ========= */
      function $(id){ return document.getElementById(id); }
      function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }

      function toast(msg){
        var el = $("toast");
        el.textContent = String(msg || "");
        el.classList.add("show");
        clearTimeout(toast._t);
        toast._t = setTimeout(function(){ el.classList.remove("show"); }, 2200);
      }

      function beep(){
        try{
          var ctx = new (window.AudioContext || window.webkitAudioContext)();
          var o = ctx.createOscillator();
          var g = ctx.createGain();
          o.type = "sine";
          o.frequency.value = 880;
          g.gain.value = 0.02;
          o.connect(g); g.connect(ctx.destination);
          o.start();
          setTimeout(function(){ o.stop(); ctx.close(); }, 180);
        }catch(e){}
      }

      function safeGet(k){ try { return localStorage.getItem(k); } catch(e){ return null; } }
      function safeSet(k,v){ try { localStorage.setItem(k,v); } catch(e){} }

      function escapeHtml(s){
        return String(s)
          .replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;")
          .replace(/"/g,"&quot;")
          .replace(/'/g,"&#039;");
      }

      var KEY_LANG = "gtts_lang";
      var KEY_POS  = "gtts_pos";
      var KEY_VEH  = "gtts_vehicle";       // current vehicle (form)
      var KEY_ARCH = "gtts_vehicle_arch";  // archive list (MRU)

      var ROUTES = ["vehicle","navigator","tolls","fuel","hotels","nearby"];

      var LANGS = [
        {code:"en", label:"English"},
        {code:"uk", label:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞"},
        {code:"ru", label:"–†—É—Å—Å–∫–∏–π"},
        {code:"pl", label:"Polski"},
        {code:"de", label:"Deutsch"},
        {code:"fr", label:"Fran√ßais"},
        {code:"es", label:"Espa√±ol"},
        {code:"it", label:"Italiano"},
        {code:"sv", label:"Svenska"},
        {code:"cs", label:"ƒåe≈°tina"},
        {code:"ro", label:"Rom√¢nƒÉ"},
        {code:"nl", label:"Nederlands"},
      ];

      /* ========= i18n ========= */
      var I18N = {
        en: {
          locate:"Locate", share:"Share", map:"Map",
          coord:"Coordinates:", disclaimer:"Prototype. Do not use for real payments.",
          note:"MVP demo (no real payments).",
          vehicle:"Vehicle", vehicleTitle:"Vehicle profile",
          vehicleDesc:"Vehicle parameters used for tolls, fuel and routing restrictions.",
          nav:"Navigator", tolls:"Tolls", fuel:"Fuel", hotels:"Hotels", nearby:"Nearby",
          mapPlaceholder:"Map placeholder. Click ‚ÄúLocate‚Äù to set your position, then browse modules.",
          posUnknown:"Unknown (click Locate)",
          backMenu:"Back to menu",
          /* vehicle fields */
          archive:"Vehicle archive (MRU)",
          apply:"Apply",
          plate:"Plate number",
          country:"Country",
          type:"Vehicle type (EU)",
          fuelType:"Fuel type",
          emission:"Emission class",
          axles:"Axles (vehicle)",
          gvwr:"Gross vehicle weight (GVW)",
          withTrailer:"With trailer",
          trailerPlate:"Trailer plate number",
          trailerAxles:"Axles (trailer)",
          gtw:"Gross trailer weight (GTW)",
          save:"Save",
          reset:"Reset to demo",
          saved:"Saved",
          resetDone:"Reset",
          select:"Select‚Ä¶",
          reqHint:"Tip: routing restrictions depend on vehicle class, weight, axles and trailer.",
          /* fuels */
          f_diesel:"Diesel",
          f_petrol:"Petrol",
          f_lpg:"LPG",
          f_cng:"CNG",
          f_lng:"LNG",
          f_electric:"Electric",
          f_hydrogen:"Hydrogen",
          f_hybrid:"Hybrid",
          /* eco */
          e_euro0:"Euro 0 / Unknown",
          e_euro1:"Euro 1",
          e_euro2:"Euro 2",
          e_euro3:"Euro 3",
          e_euro4:"Euro 4",
          e_euro5:"Euro 5",
          e_euro6:"Euro 6",
          e_euro6d:"Euro 6d",
          e_euroVI:"Euro VI (HDV)",
          /* axles */
          a_1:"1", a_2:"2", a_3:"3", a_4:"4", a_5:"5", a_6:"6", a_7:"7", a_8:"8", a_9:"9", a_10:"10+",
          /* weights */
          w_35:"‚â§ 3.5 t",
          w_3575:"3.5‚Äì7.5 t",
          w_7512:"7.5‚Äì12 t",
          w_12p:"> 12 t",
          /* groups */
          gL:"L (mopeds & motorcycles)",
          gM:"M (passenger)",
          gN:"N (goods)",
          /* navigator */
          navTitle:"Navigator (demo)",
          navDesc:"Uses vehicle parameters from ‚ÄúVehicle‚Äù and simulates routing restrictions.",
          fromHere:"From my position",
          to:"Destination",
          buildRoute:"Build route",
          routeReady:"Route ready (demo)",
          restriction:"Restrictions",
          truckWarn:"Height restriction sign: 4.0 m ahead",
          truckWarn2:"Truck restriction zone detected (demo)",
          /* countries */
          c_PL:"Poland", c_DE:"Germany", c_FR:"France", c_ES:"Spain", c_IT:"Italy", c_NL:"Netherlands", c_BE:"Belgium",
          c_LU:"Luxembourg", c_AT:"Austria", c_CZ:"Czechia", c_SK:"Slovakia", c_HU:"Hungary", c_RO:"Romania",
          c_BG:"Bulgaria", c_HR:"Croatia", c_SI:"Slovenia", c_LT:"Lithuania", c_LV:"Latvia", c_EE:"Estonia",
          c_FI:"Finland", c_SE:"Sweden", c_DK:"Denmark", c_IE:"Ireland", c_PT:"Portugal", c_GR:"Greece",
          c_CY:"Cyprus", c_MT:"Malta",
          c_UK:"United Kingdom",
          c_UA:"Ukraine"
        },
        uk: {
          locate:"–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è", share:"–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å", map:"–ú–∞–ø–∞",
          coord:"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:", disclaimer:"–ü—Ä–æ—Ç–æ—Ç–∏–ø. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö –æ–ø–ª–∞—Ç.",
          note:"MVP –¥–µ–º–æ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö –æ–ø–ª–∞—Ç).",
          vehicle:"–ê–≤—Ç–æ–º–æ–±—ñ–ª—å", vehicleTitle:"–ü—Ä–æ—Ñ—ñ–ª—å –∞–≤—Ç–æ–º–æ–±—ñ–ª—è",
          vehicleDesc:"–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–≤—Ç–æ –¥–ª—è –æ–ø–ª–∞—Ç–∏ –¥–æ—Ä—ñ–≥, –∑–∞–ø—Ä–∞–≤–∫–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó.",
          nav:"–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä", tolls:"–û–ø–ª–∞—Ç–∞ –¥–æ—Ä—ñ–≥", fuel:"–ó–∞–ø—Ä–∞–≤–∫–∞", hotels:"–ì–æ—Ç–µ–ª—ñ", nearby:"–ú—ñ—Å—Ü—è –ø–æ—Ä—É—á",
          mapPlaceholder:"–ó–∞–≥–ª—É—à–∫–∞ –º–∞–ø–∏. –ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è‚Äù, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é, —ñ –æ–±–∏—Ä–∞–π –º–æ–¥—É–ª—ñ.",
          posUnknown:"–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–∞—Ç–∏—Å–Ω–∏ –ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è)",
          backMenu:"–î–æ –º–µ–Ω—é",
          archive:"–ê—Ä—Ö—ñ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏—Ö –∑–∞—Å–æ–±—ñ–≤ (–æ—Å—Ç–∞–Ω–Ω—ñ –∑–≤–µ—Ä—Ö—É)",
          apply:"–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏",
          plate:"–ù–æ–º–µ—Ä",
          country:"–ö—Ä–∞—ó–Ω–∞",
          type:"–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –∑–∞—Å–æ–±—É (–Ñ–°)",
          fuelType:"–¢–∏–ø –ø–∞–ª—å–Ω–æ–≥–æ",
          emission:"–ï–∫–æ-–∫–ª–∞—Å",
          axles:"–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å–µ–π (—Ç—è–≥–∞—á/–∞–≤—Ç–æ)",
          gvwr:"–ü–æ–≤–Ω–∞ –º–∞—Å–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –∑–∞—Å–æ–±—É",
          withTrailer:"–ó –ø—Ä–∏—á–µ–ø–æ–º",
          trailerPlate:"–ù–æ–º–µ—Ä –ø—Ä–∏—á–µ–ø–∞",
          trailerAxles:"–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å–µ–π –ø—Ä–∏—á–µ–ø–∞",
          gtw:"–ü–æ–≤–Ω–∞ –º–∞—Å–∞ –ø—Ä–∏—á–µ–ø–∞",
          save:"–ó–±–µ—Ä–µ–≥—Ç–∏",
          reset:"–°–∫–∏–Ω—É—Ç–∏ –¥–µ–º–æ",
          saved:"–ó–±–µ—Ä–µ–∂–µ–Ω–æ",
          resetDone:"–°–∫–∏–Ω—É—Ç–æ",
          select:"–û–±–µ—Ä—ñ—Ç—å‚Ä¶",
          reqHint:"–ü–æ—Ä–∞–¥–∞: –æ–±–º–µ–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –∫–ª–∞—Å—É, –º–∞—Å–∏, –æ—Å–µ–π —Ç–∞ –ø—Ä–∏—á–µ–ø–∞.",
          f_diesel:"–î–∏–∑–µ–ª—å",
          f_petrol:"–ë–µ–Ω–∑–∏–Ω",
          f_lpg:"LPG (–≥–∞–∑)",
          f_cng:"CNG (–º–µ—Ç–∞–Ω)",
          f_lng:"LNG (–∑—Ä—ñ–¥–∂. –≥–∞–∑)",
          f_electric:"–ï–ª–µ–∫—Ç—Ä–æ",
          f_hydrogen:"–í–æ–¥–µ–Ω—å",
          f_hybrid:"–ì—ñ–±—Ä–∏–¥",
          e_euro0:"Euro 0 / –ù–µ–≤—ñ–¥–æ–º–æ",
          e_euro1:"Euro 1",
          e_euro2:"Euro 2",
          e_euro3:"Euro 3",
          e_euro4:"Euro 4",
          e_euro5:"Euro 5",
          e_euro6:"Euro 6",
          e_euro6d:"Euro 6d",
          e_euroVI:"Euro VI (HDV)",
          a_1:"1", a_2:"2", a_3:"3", a_4:"4", a_5:"5", a_6:"6", a_7:"7", a_8:"8", a_9:"9", a_10:"10+",
          w_35:"‚â§ 3,5 —Ç",
          w_3575:"3,5‚Äì7,5 —Ç",
          w_7512:"7,5‚Äì12 —Ç",
          w_12p:"> 12 —Ç",
          gL:"L (–º–æ–ø–µ–¥–∏ —Ç–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–∏)",
          gM:"M (–ø–∞—Å–∞–∂–∏—Ä—Å—å–∫—ñ)",
          gN:"N (–≤–∞–Ω—Ç–∞–∂–Ω—ñ)",
          navTitle:"–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä (–¥–µ–º–æ)",
          navDesc:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–µ—Ä–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑ ‚Äú–ê–≤—Ç–æ–º–æ–±—ñ–ª—å‚Äù —Ç–∞ —ñ–º—ñ—Ç—É—î –æ–±–º–µ–∂–µ–Ω–Ω—è —Ä—É—Ö—É.",
          fromHere:"–í—ñ–¥ –º–æ—î—ó –ø–æ–∑–∏—Ü—ñ—ó",
          to:"–ö—É–¥–∏",
          buildRoute:"–ü—Ä–æ–∫–ª–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç",
          routeReady:"–ú–∞—Ä—à—Ä—É—Ç –≥–æ—Ç–æ–≤–∏–π (–¥–µ–º–æ)",
          restriction:"–û–±–º–µ–∂–µ–Ω–Ω—è",
          truckWarn:"–ó–Ω–∞–∫ –æ–±–º–µ–∂–µ–Ω–Ω—è –≤–∏—Å–æ—Ç–∏: 4,0 –º –ø–æ–ø–µ—Ä–µ–¥—É",
          truckWarn2:"–í–∏—è–≤–ª–µ–Ω–æ –∑–æ–Ω—É –æ–±–º–µ–∂–µ–Ω—å –¥–ª—è –≤–∞–Ω—Ç–∞–∂–Ω–∏—Ö (–¥–µ–º–æ)",
          c_PL:"–ü–æ–ª—å—â–∞", c_DE:"–ù—ñ–º–µ—á—á–∏–Ω–∞", c_FR:"–§—Ä–∞–Ω—Ü—ñ—è", c_ES:"–Ü—Å–ø–∞–Ω—ñ—è", c_IT:"–Ü—Ç–∞–ª—ñ—è", c_NL:"–ù—ñ–¥–µ—Ä–ª–∞–Ω–¥–∏", c_BE:"–ë–µ–ª—å–≥—ñ—è",
          c_LU:"–õ—é–∫—Å–µ–º–±—É—Ä–≥", c_AT:"–ê–≤—Å—Ç—Ä—ñ—è", c_CZ:"–ß–µ—Ö—ñ—è", c_SK:"–°–ª–æ–≤–∞—á—á–∏–Ω–∞", c_HU:"–£–≥–æ—Ä—â–∏–Ω–∞", c_RO:"–†—É–º—É–Ω—ñ—è",
          c_BG:"–ë–æ–ª–≥–∞—Ä—ñ—è", c_HR:"–•–æ—Ä–≤–∞—Ç—ñ—è", c_SI:"–°–ª–æ–≤–µ–Ω—ñ—è", c_LT:"–õ–∏—Ç–≤–∞", c_LV:"–õ–∞—Ç–≤—ñ—è", c_EE:"–ï—Å—Ç–æ–Ω—ñ—è",
          c_FI:"–§—ñ–Ω–ª—è–Ω–¥—ñ—è", c_SE:"–®–≤–µ—Ü—ñ—è", c_DK:"–î–∞–Ω—ñ—è", c_IE:"–Ü—Ä–ª–∞–Ω–¥—ñ—è", c_PT:"–ü–æ—Ä—Ç—É–≥–∞–ª—ñ—è", c_GR:"–ì—Ä–µ—Ü—ñ—è",
          c_CY:"–ö—ñ–ø—Ä", c_MT:"–ú–∞–ª—å—Ç–∞",
          c_UK:"–í–µ–ª–∏–∫–∞ –ë—Ä–∏—Ç–∞–Ω—ñ—è",
          c_UA:"–£–∫—Ä–∞—ó–Ω–∞"
        },
        ru: {
          locate:"–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è", share:"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è", map:"–ö–∞—Ä—Ç–∞",
          coord:"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:", disclaimer:"–ü—Ä–æ—Ç–æ—Ç–∏–ø. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–ø–ª–∞—Ç.",
          note:"MVP –¥–µ–º–æ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–ø–ª–∞—Ç).",
          vehicle:"–ê–≤—Ç–æ–º–æ–±–∏–ª—å", vehicleTitle:"–ü—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è",
          vehicleDesc:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¢–° –¥–ª—è –¥–æ—Ä–æ–≥, —Ç–æ–ø–ª–∏–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.",
          nav:"–ù–∞–≤–∏–≥–∞—Ç–æ—Ä", tolls:"–û–ø–ª–∞—Ç–∞ –¥–æ—Ä–æ–≥", fuel:"–ó–∞–ø—Ä–∞–≤–∫–∞", hotels:"–û—Ç–µ–ª–∏", nearby:"–ú–µ—Å—Ç–∞ —Ä—è–¥–æ–º",
          mapPlaceholder:"–ó–∞–≥–ª—É—à–∫–∞ –∫–∞—Ä—Ç—ã. –ù–∞–∂–º–∏ ‚Äú–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è‚Äù, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é, –∏ –≤—ã–±–∏—Ä–∞–π –º–æ–¥—É–ª–∏.",
          posUnknown:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ (–Ω–∞–∂–º–∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è)",
          backMenu:"–í –º–µ–Ω—é",
          archive:"–ê—Ä—Ö–∏–≤ –¢–° (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—Ä—Ö—É)",
          apply:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å",
          plate:"–ù–æ–º–µ—Ä",
          country:"–°—Ç—Ä–∞–Ω–∞",
          type:"–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ (–ï–°)",
          fuelType:"–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞",
          emission:"–≠–∫–æ-–∫–ª–∞—Å—Å",
          axles:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–µ–π (—Ç—è–≥–∞—á/–¢–°)",
          gvwr:"–ü–æ–ª–Ω–∞—è –º–∞—Å—Å–∞ –¢–°",
          withTrailer:"–° –ø—Ä–∏—Ü–µ–ø–æ–º",
          trailerPlate:"–ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞",
          trailerAxles:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–µ–π –ø—Ä–∏—Ü–µ–ø–∞",
          gtw:"–ü–æ–ª–Ω–∞—è –º–∞—Å—Å–∞ –ø—Ä–∏—Ü–µ–ø–∞",
          save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
          reset:"–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ",
          saved:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",
          resetDone:"–°–±—Ä–æ—à–µ–Ω–æ",
          select:"–í—ã–±–µ—Ä–∏—Ç–µ‚Ä¶",
          reqHint:"–ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–ª–∞—Å—Å–∞, –º–∞—Å—Å—ã, –æ—Å–µ–π –∏ –ø—Ä–∏—Ü–µ–ø–∞.",
          f_diesel:"–î–∏–∑–µ–ª—å",
          f_petrol:"–ë–µ–Ω–∑–∏–Ω",
          f_lpg:"LPG (–≥–∞–∑)",
          f_cng:"CNG (–º–µ—Ç–∞–Ω)",
          f_lng:"LNG (—Å–∂–∏–∂. –≥–∞–∑)",
          f_electric:"–≠–ª–µ–∫—Ç—Ä–æ",
          f_hydrogen:"–í–æ–¥–æ—Ä–æ–¥",
          f_hybrid:"–ì–∏–±—Ä–∏–¥",
          e_euro0:"Euro 0 / –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
          e_euro1:"Euro 1",
          e_euro2:"Euro 2",
          e_euro3:"Euro 3",
          e_euro4:"Euro 4",
          e_euro5:"Euro 5",
          e_euro6:"Euro 6",
          e_euro6d:"Euro 6d",
          e_euroVI:"Euro VI (HDV)",
          a_1:"1", a_2:"2", a_3:"3", a_4:"4", a_5:"5", a_6:"6", a_7:"7", a_8:"8", a_9:"9", a_10:"10+",
          w_35:"‚â§ 3,5 —Ç",
          w_3575:"3,5‚Äì7,5 —Ç",
          w_7512:"7,5‚Äì12 —Ç",
          w_12p:"> 12 —Ç",
          gL:"L (–º–æ–ø–µ–¥—ã –∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ã)",
          gM:"M (–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–µ)",
          gN:"N (–≥—Ä—É–∑–æ–≤—ã–µ)",
          navTitle:"–ù–∞–≤–∏–≥–∞—Ç–æ—Ä (–¥–µ–º–æ)",
          navDesc:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ ‚Äú–ê–≤—Ç–æ–º–æ–±–∏–ª—å‚Äù –∏ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è.",
          fromHere:"–û—Ç –º–æ–µ–π –ø–æ–∑–∏—Ü–∏–∏",
          to:"–ö—É–¥–∞",
          buildRoute:"–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç",
          routeReady:"–ú–∞—Ä—à—Ä—É—Ç –≥–æ—Ç–æ–≤ (–¥–µ–º–æ)",
          restriction:"–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è",
          truckWarn:"–ó–Ω–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã: 4,0 –º –≤–ø–µ—Ä–µ–¥–∏",
          truckWarn2:"–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–æ–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è –≥—Ä—É–∑–æ–≤—ã—Ö (–¥–µ–º–æ)",
          c_PL:"–ü–æ–ª—å—à–∞", c_DE:"–ì–µ—Ä–º–∞–Ω–∏—è", c_FR:"–§—Ä–∞–Ω—Ü–∏—è", c_ES:"–ò—Å–ø–∞–Ω–∏—è", c_IT:"–ò—Ç–∞–ª–∏—è", c_NL:"–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã", c_BE:"–ë–µ–ª—å–≥–∏—è",
          c_LU:"–õ—é–∫—Å–µ–º–±—É—Ä–≥", c_AT:"–ê–≤—Å—Ç—Ä–∏—è", c_CZ:"–ß–µ—Ö–∏—è", c_SK:"–°–ª–æ–≤–∞–∫–∏—è", c_HU:"–í–µ–Ω–≥—Ä–∏—è", c_RO:"–†—É–º—ã–Ω–∏—è",
          c_BG:"–ë–æ–ª–≥–∞—Ä–∏—è", c_HR:"–•–æ—Ä–≤–∞—Ç–∏—è", c_SI:"–°–ª–æ–≤–µ–Ω–∏—è", c_LT:"–õ–∏—Ç–≤–∞", c_LV:"–õ–∞—Ç–≤–∏—è", c_EE:"–≠—Å—Ç–æ–Ω–∏—è",
          c_FI:"–§–∏–Ω–ª—è–Ω–¥–∏—è", c_SE:"–®–≤–µ—Ü–∏—è", c_DK:"–î–∞–Ω–∏—è", c_IE:"–ò—Ä–ª–∞–Ω–¥–∏—è", c_PT:"–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è", c_GR:"–ì—Ä–µ—Ü–∏—è",
          c_CY:"–ö–∏–ø—Ä", c_MT:"–ú–∞–ª—å—Ç–∞",
          c_UK:"–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è",
          c_UA:"–£–∫—Ä–∞–∏–Ω–∞"
        }
      };

      function t(key){
        var lang = $("lang").value || "uk";
        var dict = I18N[lang] || I18N.en;
        return (dict && dict[key]) ? dict[key] : (I18N.en[key] || key);
      }

      /* ========= Drawer ========= */
      function openDrawer(){
        $("drawer").classList.add("open");
        $("drawer").setAttribute("aria-hidden","false");
        $("backdrop").classList.add("show");
      }
      function closeDrawer(){
        $("drawer").classList.remove("open");
        $("drawer").setAttribute("aria-hidden","true");
        $("backdrop").classList.remove("show");
      }

      /* ========= Position ========= */
      function getPos(){
        var raw = safeGet(KEY_POS);
        if(!raw) return null;
        try { return JSON.parse(raw); } catch(e){ return null; }
      }
      function setPos(pos){
        safeSet(KEY_POS, JSON.stringify(pos));
        $("coord").textContent = pos.lat.toFixed(5)+", "+pos.lng.toFixed(5);
      }
      function locate(){
        $("pillStatus").textContent = "‚Ä¶";
        if(!navigator.geolocation){
          $("pillStatus").textContent = "Demo";
          toast("No geolocation available");
          return;
        }
        navigator.geolocation.getCurrentPosition(
          function(p){
            setPos({lat:p.coords.latitude, lng:p.coords.longitude});
            $("pillStatus").textContent = "OK";
            toast("Location set");
          },
          function(){
            $("pillStatus").textContent = "Demo";
            toast("Location denied / unavailable");
          },
          { enableHighAccuracy:true, timeout:10000, maximumAge:60000 }
        );
      }
      function shareLink(){
        var url = location.href;
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(url).then(function(){ toast("Copied"); })
            .catch(function(){ prompt("Copy link:", url); });
        } else {
          prompt("Copy link:", url);
        }
      }

      /* ========= Icons (2x2cm ~ 76px) ========= */
      function iconSvg(kind){
        var bg = '<rect x="3" y="3" width="70" height="70" rx="14" fill="var(--iconBg)" stroke="var(--iconBorder)" stroke-width="6"/>';
        if(kind === "moto"){
          return '' +
            '<svg viewBox="0 0 76 76" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">' +
              bg +
              '<circle cx="24" cy="52" r="9" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<circle cx="54" cy="52" r="9" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<path d="M26 52h13l8-16h10" fill="none" stroke="var(--iconRed1)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>' +
              '<path d="M38 36l-6 12" fill="none" stroke="var(--iconRed3)" stroke-width="5" stroke-linecap="round"/>' +
              '<path d="M40 36h12" fill="none" stroke="var(--iconHi)" stroke-width="4" stroke-linecap="round" opacity=".9"/>' +
              '<path d="M46 30c4 0 6 2 7 5" fill="none" stroke="var(--iconRed3)" stroke-width="4" stroke-linecap="round" opacity=".9"/>' +
              '<path d="M58 34l6 2" stroke="var(--iconRed2)" stroke-width="4" stroke-linecap="round" />' +
            '</svg>';
        }
        if(kind === "car"){
          return '' +
            '<svg viewBox="0 0 76 76" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">' +
              bg +
              '<rect x="14" y="40" width="48" height="16" rx="10" fill="none" stroke="var(--iconRed1)" stroke-width="5"/>' +
              '<path d="M22 40c4-10 10-14 19-14h6c9 0 15 4 19 14" fill="var(--iconHi)" opacity=".9" stroke="var(--iconRed3)" stroke-width="3" />' +
              '<circle cx="26" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<circle cx="50" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<path d="M20 46h36" stroke="var(--iconRed3)" stroke-width="3" opacity=".65"/>' +
            '</svg>';
        }
        if(kind === "microbus"){
          return '' +
            '<svg viewBox="0 0 76 76" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">' +
              bg +
              '<rect x="14" y="30" width="48" height="28" rx="12" fill="none" stroke="var(--iconRed1)" stroke-width="5"/>' +
              '<rect x="20" y="36" width="26" height="10" rx="4" fill="var(--iconHi)" opacity=".9" stroke="var(--iconRed3)" stroke-width="2"/>' +
              '<rect x="48" y="36" width="10" height="18" rx="4" fill="var(--iconHi)" opacity=".9" stroke="var(--iconRed3)" stroke-width="2"/>' +
              '<circle cx="28" cy="58" r="7" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<circle cx="52" cy="58" r="7" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<path d="M16 48h44" stroke="var(--iconRed3)" stroke-width="3" opacity=".7"/>' +
              '<path d="M60 44l4 2" stroke="var(--iconRed2)" stroke-width="4" stroke-linecap="round"/>' +
            '</svg>';
        }
        if(kind === "truckSmall"){
          return '' +
            '<svg viewBox="0 0 76 76" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">' +
              bg +
              '<rect x="14" y="40" width="26" height="14" rx="7" fill="none" stroke="var(--iconRed1)" stroke-width="5"/>' +
              '<rect x="40" y="36" width="22" height="18" rx="8" fill="var(--iconHi)" opacity=".9" stroke="var(--iconRed3)" stroke-width="3"/>' +
              '<rect x="44" y="40" width="9" height="7" rx="3" fill="var(--iconBg)" opacity=".95" stroke="var(--iconRed2)" stroke-width="2"/>' +
              '<circle cx="26" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<circle cx="54" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
              '<path d="M14 54h50" stroke="var(--iconRed3)" stroke-width="3" opacity=".7"/>' +
              '<path d="M62 44l5 2" stroke="var(--iconRed2)" stroke-width="4" stroke-linecap="round"/>' +
            '</svg>';
        }
        /* truck heavy */
        return '' +
          '<svg viewBox="0 0 76 76" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">' +
            bg +
            '<rect x="12" y="38" width="30" height="16" rx="7" fill="none" stroke="var(--iconRed1)" stroke-width="5"/>' +
            '<rect x="42" y="34" width="22" height="20" rx="8" fill="var(--iconHi)" opacity=".9" stroke="var(--iconRed3)" stroke-width="3"/>' +
            '<rect x="46" y="38" width="9" height="7" rx="3" fill="var(--iconBg)" opacity=".95" stroke="var(--iconRed2)" stroke-width="2"/>' +
            '<circle cx="24" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
            '<circle cx="46" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
            '<circle cx="60" cy="56" r="8" fill="none" stroke="var(--iconRed2)" stroke-width="4"/>' +
            '<path d="M12 54h56" stroke="var(--iconRed3)" stroke-width="3" opacity=".7"/>' +
            '<path d="M64 42l6 2" stroke="var(--iconRed2)" stroke-width="4" stroke-linecap="round"/>' +
          '</svg>';
      }

      /* ========= Vehicle types (with icons aligned to categories) =========
         - direction assumed right by design of icons
      */
      var EU_TYPES = [
        { groupKey:"gL", kind:"moto", items: [
          { code:"L",  labelEn:"L ‚Äî Mopeds & motorcycles", labelUk:"L ‚Äî –ú–æ–ø–µ–¥–∏ —Ç–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–∏", labelRu:"L ‚Äî –ú–æ–ø–µ–¥—ã –∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ã" }
        ]},
        { groupKey:"gM", kind:"car", items: [
          { code:"M1", labelEn:"M1 ‚Äî passenger car", labelUk:"M1 ‚Äî –ª–µ–≥–∫–æ–≤–∏–π", labelRu:"M1 ‚Äî –ª–µ–≥–∫–æ–≤–æ–π" },
          { code:"M2", labelEn:"M2 ‚Äî minibus (‚â§5t)", labelUk:"M2 ‚Äî –º—ñ–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å (‚â§5—Ç)", labelRu:"M2 ‚Äî –º–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å (‚â§5—Ç)" },
          { code:"M3", labelEn:"M3 ‚Äî bus (>5t)", labelUk:"M3 ‚Äî –∞–≤—Ç–æ–±—É—Å (>5—Ç)", labelRu:"M3 ‚Äî –∞–≤—Ç–æ–±—É—Å (>5—Ç)" }
        ]},
        { groupKey:"gN", kind:"truck", items: [
          { code:"N1", labelEn:"N1 ‚Äî light truck (‚â§3.5t)", labelUk:"N1 ‚Äî –Ω–µ–≤–µ–ª–∏–∫–∞ –≤–∞–Ω—Ç–∞–∂—ñ–≤–∫–∞ (‚â§3,5—Ç)", labelRu:"N1 ‚Äî –Ω–µ–±–æ–ª—å—à–æ–π –≥—Ä—É–∑–æ–≤–∏–∫ (‚â§3,5—Ç)" },
          { code:"N2", labelEn:"N2 ‚Äî truck (3.5‚Äì12t)", labelUk:"N2 ‚Äî –≤–∞–Ω—Ç–∞–∂–Ω–∏–π (3,5‚Äì12—Ç)", labelRu:"N2 ‚Äî –≥—Ä—É–∑–æ–≤–æ–π (3,5‚Äì12—Ç)" },
          { code:"N3", labelEn:"N3 ‚Äî truck (>12t)", labelUk:"N3 ‚Äî –≤–∞–Ω—Ç–∞–∂–Ω–∏–π (>12—Ç)", labelRu:"N3 ‚Äî –≥—Ä—É–∑–æ–≤–æ–π (>12—Ç)" }
        ]}
      ];

      function typeLabel(it){
        var lang = $("lang").value || "uk";
        if(lang === "uk") return it.labelUk;
        if(lang === "ru") return it.labelRu;
        return it.labelEn;
      }

      function typeIcon(kind, code){
        // Use specific icons for microbus and light truck
        if(code === "M2") return iconSvg("microbus");
        if(code === "N1") return iconSvg("truckSmall");
        if(kind === "moto") return iconSvg("moto");
        if(kind === "car")  return iconSvg("car");
        if(kind === "truck")return iconSvg("truck");
        return iconSvg("car");
      }

      /* ========= Countries + waving flags (simple gradient approximations) ========= */
      var COUNTRY_CODES = ["PL","DE","FR","ES","IT","NL","BE","LU","AT","CZ","SK","HU","RO","BG","HR","SI","LT","LV","EE","FI","SE","DK","IE","PT","GR","CY","MT","UK","UA"];

      // Minimal color-band approximations (enough for UI). Many flags have coats-of-arms: ignored in gradients.
      var FLAG_GRAD = {
        PL:"linear-gradient(180deg,#ffffff 0 50%, #dc143c 50% 100%)",
        DE:"linear-gradient(180deg,#000000 0 33%, #dd0000 33% 66%, #ffce00 66% 100%)",
        FR:"linear-gradient(90deg,#0055a4 0 33%, #ffffff 33% 66%, #ef4135 66% 100%)",
        ES:"linear-gradient(180deg,#aa151b 0 25%, #f1bf00 25% 75%, #aa151b 75% 100%)",
        IT:"linear-gradient(90deg,#009246 0 33%, #ffffff 33% 66%, #ce2b37 66% 100%)",
        NL:"linear-gradient(180deg,#ae1c28 0 33%, #ffffff 33% 66%, #21468b 66% 100%)",
        BE:"linear-gradient(90deg,#000000 0 33%, #ffd90c 33% 66%, #ef3340 66% 100%)",
        LU:"linear-gradient(180deg,#ef3340 0 33%, #ffffff 33% 66%, #00a3e0 66% 100%)",
        AT:"linear-gradient(180deg,#ed2939 0 33%, #ffffff 33% 66%, #ed2939 66% 100%)",
        CZ:"linear-gradient(180deg,#ffffff 0 50%, #d7141a 50% 100%), linear-gradient(135deg,#11457e 0 50%, transparent 50% 100%)",
        SK:"linear-gradient(180deg,#ffffff 0 33%, #0b4ea2 33% 66%, #ee1c25 66% 100%)",
        HU:"linear-gradient(180deg,#ce2939 0 33%, #ffffff 33% 66%, #477050 66% 100%)",
        RO:"linear-gradient(90deg,#002b7f 0 33%, #fcd116 33% 66%, #ce1126 66% 100%)",
        BG:"linear-gradient(180deg,#ffffff 0 33%, #00966e 33% 66%, #d62612 66% 100%)",
        HR:"linear-gradient(180deg,#ff0000 0 33%, #ffffff 33% 66%, #171796 66% 100%)",
        SI:"linear-gradient(180deg,#ffffff 0 33%, #005da4 33% 66%, #ed1c24 66% 100%)",
        LT:"linear-gradient(180deg,#fdb913 0 33%, #006a44 33% 66%, #c1272d 66% 100%)",
        LV:"linear-gradient(180deg,#9e3039 0 40%, #ffffff 40% 60%, #9e3039 60% 100%)",
        EE:"linear-gradient(180deg,#0072ce 0 33%, #000000 33% 66%, #ffffff 66% 100%)",
        FI:"linear-gradient(90deg,#ffffff 0 100%), linear-gradient(90deg, transparent 0 30%, #003580 30% 44%, transparent 44% 100%), linear-gradient(180deg, transparent 0 40%, #003580 40% 56%, transparent 56% 100%)",
        SE:"linear-gradient(90deg,#006aa7 0 100%), linear-gradient(90deg, transparent 0 30%, #fecc00 30% 44%, transparent 44% 100%), linear-gradient(180deg, transparent 0 40%, #fecc00 40% 56%, transparent 56% 100%)",
        DK:"linear-gradient(90deg,#c60c30 0 100%), linear-gradient(90deg, transparent 0 28%, #ffffff 28% 38%, transparent 38% 100%), linear-gradient(180deg, transparent 0 44%, #ffffff 44% 54%, transparent 54% 100%)",
        IE:"linear-gradient(90deg,#169b62 0 33%, #ffffff 33% 66%, #ff883e 66% 100%)",
        PT:"linear-gradient(90deg,#006600 0 40%, #ff0000 40% 100%)",
        GR:"repeating-linear-gradient(180deg,#0d5eaf 0 10%, #ffffff 10% 20%)",
        CY:"linear-gradient(180deg,#ffffff 0 100%)",
        MT:"linear-gradient(90deg,#ffffff 0 50%, #cf142b 50% 100%)",
        UK:"linear-gradient(135deg,#012169 0 100%)",
        UA:"linear-gradient(180deg,#0057b7 0 50%, #ffd700 50% 100%)"
      };

      function flagThumb(countryCode){
        var grad = FLAG_GRAD[countryCode] || "linear-gradient(90deg,#fff,#ddd)";
        return '<div class="flag" style="--flagGrad:'+grad+'"></div>';
      }

      /* ========= Vehicle data + archive (MRU by plate) ========= */
      function demoVehicle(){
        return {
          plate:"AB1234CD",
          country:"PL",
          type:"N3",
          fuelType:"diesel",
          emission:"euro6",
          axles:"5",
          gvwr:"w_12p",
          withTrailer:false,
          trailerPlate:"",
          trailerAxles:"2",
          gtw:"w_7512"
        };
      }

      function getVehicle(){
        var raw = safeGet(KEY_VEH);
        if(!raw) return demoVehicle();
        try{
          var v = JSON.parse(raw);
          // backfill
          if(typeof v.withTrailer !== "boolean") v.withTrailer = !!v.withTrailer;
          if(!v.trailerAxles) v.trailerAxles = "2";
          return v;
        }catch(e){ return demoVehicle(); }
      }
      function setVehicle(v){ safeSet(KEY_VEH, JSON.stringify(v)); }

      function getArchive(){
        var raw = safeGet(KEY_ARCH);
        if(!raw) return [];
        try{
          var arr = JSON.parse(raw);
          return Array.isArray(arr) ? arr : [];
        }catch(e){ return []; }
      }
      function setArchive(arr){ safeSet(KEY_ARCH, JSON.stringify(arr)); }

      function upsertArchive(vehicle){
        var plate = (vehicle.plate || "").trim().toUpperCase();
        if(!plate) return;
        var arch = getArchive();

        // remove any existing with same plate
        arch = arch.filter(function(x){ return (x.plate || "").toUpperCase() !== plate; });

        // push to front (MRU)
        var copy = JSON.parse(JSON.stringify(vehicle));
        copy.plate = plate;
        copy._ts = Date.now();
        arch.unshift(copy);

        // keep reasonable size
        if(arch.length > 50) arch = arch.slice(0,50);

        setArchive(arch);
      }

      function applyFromArchive(plate){
        var arch = getArchive();
        var found = null;
        for(var i=0;i<arch.length;i++){
          if((arch[i].plate || "").toUpperCase() === (plate || "").toUpperCase()){
            found = arch[i];
            break;
          }
        }
        if(found){
          setVehicle(found);
          // move it to front
          upsertArchive(found);
          toast(t("apply"));
        }
      }

      /* ========= Options builders ========= */
      var FUEL_KEYS = ["diesel","petrol","lpg","cng","lng","electric","hydrogen","hybrid"];
      var ECO_KEYS  = ["euro0","euro1","euro2","euro3","euro4","euro5","euro6","euro6d","euroVI"];
      var AXLE_KEYS = ["1","2","3","4","5","6","7","8","9","10+"];
      var WEIGHT_KEYS = ["w_35","w_3575","w_7512","w_12p"];

      function buildSimpleOptions(keys, selected, prefix){
        var html = '<option value="" disabled>' + escapeHtml(t("select")) + '</option>';
        for(var i=0;i<keys.length;i++){
          var k = keys[i];
          var key = prefix ? (prefix + k) : k;
          var sel = (k === selected) ? " selected" : "";
          html += '<option value="' + escapeHtml(k) + '"' + sel + '>' + escapeHtml(t(key)) + '</option>';
        }
        return html;
      }

      function axleKeyToI18nKey(a){
        if(a === "10+") return "a_10";
        return "a_" + a;
      }
      function buildAxleOptions(selected){
        var html = '<option value="" disabled>' + escapeHtml(t("select")) + '</option>';
        for (var i=0;i<AXLE_KEYS.length;i++){
          var a = AXLE_KEYS[i];
          var key = axleKeyToI18nKey(a);
          var sel = (a === selected) ? " selected" : "";
          html += '<option value="' + escapeHtml(a) + '"' + sel + '>' + escapeHtml(t(key)) + '</option>';
        }
        return html;
      }
      function buildWeightOptions(selected){
        var html = '<option value="" disabled>' + escapeHtml(t("select")) + '</option>';
        for (var i=0;i<WEIGHT_KEYS.length;i++){
          var wk = WEIGHT_KEYS[i];
          var sel = (wk === selected) ? " selected" : "";
          html += '<option value="' + wk + '"' + sel + '>' + escapeHtml(t(wk)) + '</option>';
        }
        return html;
      }

      /* ========= Custom Select: Vehicle Type ========= */
      function findType(code){
        for (var g=0; g<EU_TYPES.length; g++){
          for (var i=0; i<EU_TYPES[g].items.length; i++){
            if(EU_TYPES[g].items[i].code === code) return { group: EU_TYPES[g], item: EU_TYPES[g].items[i] };
          }
        }
        return null;
      }

      function renderVehicleTypeSelect(selectedCode){
        var found = findType(selectedCode) || findType("N3");
        var kind = found ? found.group.kind : "truck";
        var label = found ? typeLabel(found.item) : "N3";
        var code  = found ? found.item.code : "N3";

        var menu = "";
        for (var g=0; g<EU_TYPES.length; g++){
          var grp = EU_TYPES[g];
          menu += '<div class="xgroup">' + escapeHtml(t(grp.groupKey)) + '</div>';
          for (var i=0; i<grp.items.length; i++){
            var it = grp.items[i];
            var active = (it.code === selectedCode) ? " active" : "";
            menu += '' +
              '<div class="xopt' + active + '" role="option" tabindex="0" data-code="' + escapeHtml(it.code) + '">' +
                '<div class="thumb">' + typeIcon(grp.kind, it.code) + '</div>' +
                '<div class="xtext">' +
                  '<div class="xlabel">' + escapeHtml(typeLabel(it)) + '</div>' +
                  '<div class="xcode">' + escapeHtml(it.code) + '</div>' +
                '</div>' +
              '</div>';
          }
        }

        return '' +
          '<div class="xselect" id="vehTypeSelect">' +
            '<button type="button" class="xselectBtn" id="vehTypeBtn" aria-haspopup="listbox" aria-expanded="false">' +
              '<div class="thumb" id="vehTypeThumb">' + typeIcon(kind, code) + '</div>' +
              '<div class="xtext">' +
                '<div class="xlabel" id="vehTypeLabel">' + escapeHtml(label) + '</div>' +
                '<div class="xcode" id="vehTypeCode">' + escapeHtml(code) + '</div>' +
              '</div>' +
              '<div class="caret">‚ñæ</div>' +
            '</button>' +
            '<div class="xmenu" id="vehTypeMenu" role="listbox" aria-label="Vehicle type">' +
              menu +
            '</div>' +
            '<input type="hidden" id="vehType" value="' + escapeHtml(code) + '">' +
          '</div>';
      }

      function wireXSelect(rootId, btnId, menuId, onSelect){
        var root = $(rootId);
        if(!root) return;
        var btn  = $(btnId);

        function open(){
          root.classList.add("open");
          btn.setAttribute("aria-expanded","true");
          var active = root.querySelector(".xopt.active");
          if(active) active.focus();
        }
        function close(){
          root.classList.remove("open");
          btn.setAttribute("aria-expanded","false");
        }
        function toggle(){
          if(root.classList.contains("open")) close(); else open();
        }

        btn.addEventListener("click", function(e){
          e.preventDefault();
          toggle();
        });

        document.addEventListener("click", function(e){
          if(!root.contains(e.target)) close();
        }, { passive:true });

        $all("#"+menuId+" .xopt").forEach(function(opt){
          opt.addEventListener("click", function(){
            var code = opt.getAttribute("data-code");
            onSelect(code);
            close();
          });
          opt.addEventListener("keydown", function(ev){
            if(ev.key === "Enter" || ev.key === " "){
              ev.preventDefault();
              var code = opt.getAttribute("data-code");
              onSelect(code);
              close();
            }
            if(ev.key === "Escape"){
              ev.preventDefault();
              close(); btn.focus();
            }
          });
        });

        btn.addEventListener("keydown", function(ev){
          if(ev.key === "Escape"){ ev.preventDefault(); close(); }
        });

        return { close: close };
      }

      /* ========= Custom Select: Country (with waving flag) ========= */
      function renderCountrySelect(selectedCode){
        var cc = selectedCode || "PL";
        var label = t("c_"+cc);

        var menu = "";
        menu += '<div class="xgroup">' + escapeHtml(t("country")) + '</div>';
        for (var i=0;i<COUNTRY_CODES.length;i++){
          var c = COUNTRY_CODES[i];
          var active = (c === cc) ? " active" : "";
          menu += ''+
            '<div class="xopt'+active+'" role="option" tabindex="0" data-code="'+escapeHtml(c)+'">'+
              '<div class="thumb" style="background:transparent;border:none;justify-content:flex-start">' + flagThumb(c) + '</div>'+
              '<div class="xtext">'+
                '<div class="xlabel">'+ escapeHtml(t("c_"+c)) +'</div>'+
                '<div class="xcode">'+ escapeHtml(c) +'</div>'+
              '</div>'+
            '</div>';
        }

        return '' +
          '<div class="xselect" id="countrySelect">' +
            '<button type="button" class="xselectBtn" id="countryBtn" aria-haspopup="listbox" aria-expanded="false">' +
              '<div class="thumb" style="background:transparent;border:none;justify-content:flex-start" id="countryThumb">' + flagThumb(cc) + '</div>' +
              '<div class="xtext">' +
                '<div class="xlabel" id="countryLabel">' + escapeHtml(label) + '</div>' +
                '<div class="xcode" id="countryCode">' + escapeHtml(cc) + '</div>' +
              '</div>' +
              '<div class="caret">‚ñæ</div>' +
            '</button>' +
            '<div class="xmenu" id="countryMenu" role="listbox" aria-label="Country">' +
              menu +
            '</div>' +
            '<input type="hidden" id="vehCountry" value="' + escapeHtml(cc) + '">' +
          '</div>';
      }

      function updateCountryUI(cc){
        $("vehCountry").value = cc;
        $("countryLabel").textContent = t("c_"+cc);
        $("countryCode").textContent = cc;
        $("countryThumb").innerHTML = flagThumb(cc);
        $all("#countryMenu .xopt").forEach(function(el){
          el.classList.toggle("active", el.getAttribute("data-code") === cc);
        });
      }

      /* ========= UI texts ========= */
      function applyTexts(){
        $("tLocate").textContent = t("locate");
        $("tShare").textContent = t("share");
        $("tMapTitle").textContent = t("map");
        $("tMapPlaceholder").textContent = t("mapPlaceholder");
        $("tCoordLabel").textContent = t("coord");
        $("tDisclaimer").textContent = t("disclaimer");
        $("tDrawerNote").textContent = t("note");

        $("tNavVehicle").textContent = t("vehicle");
        $("tNavNav").textContent = t("nav");
        $("tNavTolls").textContent = t("tolls");
        $("tNavFuel").textContent = t("fuel");
        $("tNavHotels").textContent = t("hotels");
        $("tNavNearby").textContent = t("nearby");
      }

      function setActive(route){
        $all(".navItem").forEach(function(btn){
          btn.classList.toggle("active", btn.getAttribute("data-route") === route);
        });
      }
      function getRouteFromHash(){
        var h = (location.hash || "").replace("#","");
        return ROUTES.indexOf(h) >= 0 ? h : "vehicle";
      }

      /* ========= Navigator demo logic ========= */
      function isTruck(typeCode){
        return typeCode === "N2" || typeCode === "N3";
      }

      function buildRestrictions(vehicle){
        var arr = [];
        // simple rule demo
        if(isTruck(vehicle.type)){
          arr.push(t("truckWarn"));   // height restriction <=4m
          arr.push(t("truckWarn2"));
        }
        if(vehicle.withTrailer){
          arr.push("Trailer restrictions: avoid sharp turns / low bridges (demo)");
        }
        // weight buckets affect routing in real life; here we just display it
        arr.push("GVW: " + t(vehicle.gvwr || "w_12p"));
        if(vehicle.withTrailer){
          arr.push("GTW: " + t(vehicle.gtw || "w_7512") + ", Trailer axles: " + (vehicle.trailerAxles || "2"));
        }
        return arr;
      }

      /* ========= Render pages ========= */
      var DEMO = {
        tolls: [{ name:"A2 Demo Segment", from:"Poznan", to:"Warsaw", country:"PL", class:"N3", axles:5, estimate:"38.5 EUR" }],
        fuel: [{ name:"FuelStop A1", brand:"PartnerX", city:"Warsaw", discount:"-8%", price:"1.54 EUR/L" }],
        hotels: [{ name:"Highway Inn", city:"Lodz", type:"Hotel", stars:4, parking:true }],
        nearby: [{ name:"Old Town", city:"Warsaw", category:"Sightseeing", open:true }]
      };

      function renderBackRow(){
        return '' +
          '<div class="backRow">' +
            '<button class="backBtn" id="btnBackMenu">‚Üê ' + escapeHtml(t("backMenu")) + '</button>' +
            '<div class="pill">GTTS</div>' +
          '</div>';
      }

      function render(route){
        if(ROUTES.indexOf(route) < 0) route = "vehicle";
        setActive(route);

        $("viewPill").textContent = "MVP";
        $("viewTitle").textContent =
          route === "vehicle" ? t("vehicle") :
          route === "navigator" ? t("nav") :
          route === "tolls" ? t("tolls") :
          route === "fuel" ? t("fuel") :
          route === "hotels" ? t("hotels") :
          t("nearby");

        var pos = getPos();
        if(pos) $("coord").textContent = pos.lat.toFixed(5)+", "+pos.lng.toFixed(5);

        /* ===== Vehicle page ===== */
        if(route === "vehicle"){
          var v = getVehicle();
          var arch = getArchive();

          // archive selector (MRU)
          var archOptions = '<option value="" selected>' + escapeHtml(t("select")) + '</option>';
          for(var i=0;i<arch.length;i++){
            var plate = (arch[i].plate || "").toUpperCase();
            var label = plate + " ‚Ä¢ " + (arch[i].type || "") + " ‚Ä¢ " + (arch[i].country || "");
            archOptions += '<option value="' + escapeHtml(plate) + '">' + escapeHtml(label) + '</option>';
          }

          var trailerBlock = "";
          if(v.withTrailer){
            trailerBlock =
              '<div class="field"><div class="label">' + escapeHtml(t("trailerPlate")) + '</div>' +
                '<input id="vehTrailerPlate" class="input" value="' + escapeHtml(v.trailerPlate || "") + '" placeholder="TR1234XX">' +
              '</div>' +
              '<div class="field"><div class="label">' + escapeHtml(t("trailerAxles")) + '</div>' +
                '<select id="vehTrailerAxles" class="input">' + buildAxleOptions(v.trailerAxles || "2") + '</select>' +
              '</div>' +
              '<div class="field"><div class="label">' + escapeHtml(t("gtw")) + '</div>' +
                '<select id="vehGtw" class="input">' + buildWeightOptions(v.gtw || "w_7512") + '</select>' +
              '</div>';
          }

          $("view").innerHTML =
            renderBackRow() +
            '<h3 class="sectionTitle">' + escapeHtml(t("vehicleTitle")) + '</h3>' +
            '<div class="item">' +
              '<div class="itemSub">' + escapeHtml(t("vehicleDesc")) + '</div>' +
              '<div class="hr"></div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("archive")) + '</div>' +
                '<div style="display:flex; gap:10px; align-items:center">' +
                  '<select id="vehArchivePick" class="input" style="flex:1">' + archOptions + '</select>' +
                  '<button class="btnGhost" id="btnApplyArchive">‚Ü∫ ' + escapeHtml(t("apply")) + '</button>' +
                '</div>' +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("plate")) + '</div>' +
                '<input id="vehPlate" class="input" value="' + escapeHtml(v.plate || "") + '" placeholder="AB1234CD">' +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("country")) + '</div>' +
                renderCountrySelect(v.country || "PL") +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("type")) + '</div>' +
                renderVehicleTypeSelect(v.type || "N3") +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("fuelType")) + '</div>' +
                '<select id="vehFuel" class="input">' + buildSimpleOptions(FUEL_KEYS, v.fuelType || "diesel", "f_") + '</select>' +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("emission")) + '</div>' +
                '<select id="vehEmission" class="input">' + buildSimpleOptions(ECO_KEYS, v.emission || "euro6", "e_") + '</select>' +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("axles")) + '</div>' +
                '<select id="vehAxles" class="input">' + buildAxleOptions(v.axles || "5") + '</select>' +
              '</div>' +

              '<div class="field"><div class="label">' + escapeHtml(t("gvwr")) + '</div>' +
                '<select id="vehGvwr" class="input">' + buildWeightOptions(v.gvwr || "w_12p") + '</select>' +
              '</div>' +

              '<div class="row">' +
                '<button type="button" class="toggleBtn' + (v.withTrailer ? ' on' : '') + '" id="btnWithTrailer">' +
                  '<span class="toggleDot" aria-hidden="true"></span>' +
                  '<span>' + escapeHtml(t("withTrailer")) + '</span>' +
                '</button>' +
              '</div>' +

              '<div id="trailerBlock">' + trailerBlock + '</div>' +

              '<div class="hint">' + escapeHtml(t("reqHint")) + '</div>' +

              '<div class="row">' +
                '<button class="btn" id="btnVehSave">üíæ ' + escapeHtml(t("save")) + '</button>' +
                '<button class="btnGhost" id="btnVehReset">‚Ü∫ ' + escapeHtml(t("reset")) + '</button>' +
              '</div>' +
            '</div>';

          // Back to menu
          $("btnBackMenu").addEventListener("click", openDrawer);

          // Wire country select
          wireXSelect("countrySelect","countryBtn","countryMenu", function(code){
            updateCountryUI(code);
          });

          // Wire vehicle type select
          wireXSelect("vehTypeSelect","vehTypeBtn","vehTypeMenu", function(code){
            var res = findType(code);
            if(!res) return;
            $("vehType").value = code;
            $("vehTypeLabel").textContent = typeLabel(res.item);
            $("vehTypeCode").textContent  = code;
            $("vehTypeThumb").innerHTML   = typeIcon(res.group.kind, code);

            $all("#vehTypeMenu .xopt").forEach(function(el){
              el.classList.toggle("active", el.getAttribute("data-code") === code);
            });
          });

          // Eco-class disabled for electric/hydrogen
          function syncEcoDisabled(){
            var ft = ($("vehFuel").value || "").toLowerCase();
            var disable = (ft === "electric" || ft === "hydrogen");
            $("vehEmission").disabled = disable;
          }
          $("vehFuel").addEventListener("change", syncEcoDisabled);
          syncEcoDisabled();

          // Archive apply
          $("btnApplyArchive").addEventListener("click", function(){
            var plate = $("vehArchivePick").value;
            if(!plate){ toast(t("select")); return; }
            applyFromArchive(plate);
            render("vehicle"); // refresh form from selected archive
          });

          // Trailer toggle
          function renderTrailerBlock(withTrailer){
            var block = $("trailerBlock");
            if(!block) return;
            if(!withTrailer){ block.innerHTML = ""; return; }
            var cur = getVehicle();
            block.innerHTML =
              '<div class="field"><div class="label">' + escapeHtml(t("trailerPlate")) + '</div>' +
                '<input id="vehTrailerPlate" class="input" value="' + escapeHtml(cur.trailerPlate || "") + '" placeholder="TR1234XX">' +
              '</div>' +
              '<div class="field"><div class="label">' + escapeHtml(t("trailerAxles")) + '</div>' +
                '<select id="vehTrailerAxles" class="input">' + buildAxleOptions(cur.trailerAxles || "2") + '</select>' +
              '</div>' +
              '<div class="field"><div class="label">' + escapeHtml(t("gtw")) + '</div>' +
                '<select id="vehGtw" class="input">' + buildWeightOptions(cur.gtw || "w_7512") + '</select>' +
              '</div>';
          }

          $("btnWithTrailer").addEventListener("click", function(){
            // Preserve current unsaved edits into storage to keep smooth UX
            var cur = getVehicle();
            cur.withTrailer = !cur.withTrailer;

            cur.plate = $("vehPlate").value.trim();
            cur.country = ($("vehCountry").value || "PL").trim();
            cur.type = ($("vehType").value || "N3").trim();
            cur.fuelType = ($("vehFuel").value || "diesel").trim();
            cur.emission = ($("vehEmission").value || "euro6").trim();
            cur.axles = ($("vehAxles").value || "5").trim();
            cur.gvwr = ($("vehGvwr").value || "w_12p").trim();

            setVehicle(cur);
            this.classList.toggle("on", cur.withTrailer);
            renderTrailerBlock(cur.withTrailer);
          });

          // Save vehicle -> also update archive MRU
          $("btnVehSave").addEventListener("click", function(){
            var nv = {
              plate: $("vehPlate").value.trim().toUpperCase(),
              country: ($("vehCountry").value || "PL").trim(),
              type: ($("vehType").value || "N3").trim(),
              fuelType: ($("vehFuel").value || "diesel").trim(),
              emission: ($("vehEmission").value || "euro6").trim(),
              axles: ($("vehAxles").value || "5").trim(),
              gvwr: ($("vehGvwr").value || "w_12p").trim(),
              withTrailer: $("btnWithTrailer").classList.contains("on"),
              trailerPlate: "",
              trailerAxles: "2",
              gtw: "w_7512"
            };

            if(nv.withTrailer){
              nv.trailerPlate  = ($("vehTrailerPlate") ? $("vehTrailerPlate").value.trim().toUpperCase() : "");
              nv.trailerAxles  = ($("vehTrailerAxles") ? $("vehTrailerAxles").value : "2");
              nv.gtw           = ($("vehGtw") ? $("vehGtw").value : "w_7512");
            }

            setVehicle(nv);
            upsertArchive(nv);
            toast(t("saved"));
            render("vehicle"); // refresh archive list MRU
          });

          $("btnVehReset").addEventListener("click", function(){
            try { localStorage.removeItem(KEY_VEH); } catch(e){}
            toast(t("resetDone"));
            render("vehicle");
          });

          return;
        }

        /* ===== Navigator page (demo, auto-reads vehicle) ===== */
        if(route === "navigator"){
          var v2 = getVehicle();
          var posText = pos ? (pos.lat.toFixed(5)+", "+pos.lng.toFixed(5)) : t("posUnknown");

          $("view").innerHTML =
            renderBackRow() +
            '<h3 class="sectionTitle">' + escapeHtml(t("navTitle")) + '</h3>' +
            '<div class="item">' +
              '<div class="itemSub">' + escapeHtml(t("navDesc")) + '</div>' +
              '<div class="hr"></div>' +
              '<div class="row">' +
                '<span class="chip">Type: ' + escapeHtml(v2.type || "‚Äî") + '</span>' +
                '<span class="chip">Country: ' + escapeHtml(v2.country || "‚Äî") + '</span>' +
                '<span class="chip">GVW: ' + escapeHtml(t(v2.gvwr || "w_12p")) + '</span>' +
                '<span class="chip">Axles: ' + escapeHtml(v2.axles || "‚Äî") + '</span>' +
                (v2.withTrailer ? '<span class="chip">Trailer: ' + escapeHtml(v2.trailerPlate || "‚Äî") + '</span>' : '') +
              '</div>' +
            '</div>' +
            '<div class="hr"></div>' +
            '<div class="item">' +
              '<div class="field"><div class="label">' + escapeHtml(t("fromHere")) + '</div>' +
                '<div class="input" style="display:flex; align-items:center">' + escapeHtml(posText) + '</div>' +
              '</div>' +
              '<div class="field"><div class="label">' + escapeHtml(t("to")) + '</div>' +
                '<input id="navDest" class="input" placeholder="Warsaw, PL">' +
              '</div>' +
              '<div class="row">' +
                '<button class="btn" id="btnBuildRoute">üß≠ ' + escapeHtml(t("buildRoute")) + '</button>' +
                '<button class="btnGhost" id="btnGoVehicle">üöó ' + escapeHtml(t("vehicle")) + '</button>' +
              '</div>' +
              '<div class="hr"></div>' +
              '<div id="navOut" class="itemSub"></div>' +
            '</div>';

          $("btnBackMenu").addEventListener("click", openDrawer);

          $("btnGoVehicle").addEventListener("click", function(){
            location.hash = "#vehicle";
            render("vehicle");
          });

          $("btnBuildRoute").addEventListener("click", function(){
            var dest = ($("navDest").value || "").trim();
            if(!dest){ toast(t("to")); return; }

            // Simulated "routing engine" (demo): show restrictions based on vehicle
            var restrictions = buildRestrictions(getVehicle());

            var out = '';
            out += '<div class="row"><span class="badge">' + escapeHtml(t("routeReady")) + '</span></div>';
            out += '<div class="hr"></div>';
            out += '<div class="itemSub"><b>' + escapeHtml(t("restriction")) + ':</b></div>';
            out += '<ul style="margin:8px 0 0 18px; padding:0; color: var(--muted); line-height:1.4;">';
            for(var i=0;i<restrictions.length;i++){
              out += '<li>' + escapeHtml(restrictions[i]) + '</li>';
            }
            out += '</ul>';

            // Truck height warning <=4m should signal
            var v = getVehicle();
            if(isTruck(v.type)){
              beep(); // signal
              toast(t("truckWarn"));
            } else {
              toast(t("routeReady"));
            }

            $("navOut").innerHTML = out;
          });

          return;
        }

        /* ===== Other pages (stub) ===== */
        function renderStub(title, text){
          $("view").innerHTML =
            renderBackRow() +
            '<h3 class="sectionTitle">' + escapeHtml(title) + '</h3>' +
            '<div class="item"><div class="itemSub">' + escapeHtml(text) + '</div></div>';
          $("btnBackMenu").addEventListener("click", openDrawer);
        }

        if(route === "tolls"){ renderStub(t("tolls"), "Demo module. Next: integrate EETS & toll providers."); return; }
        if(route === "fuel"){ renderStub(t("fuel"), "Demo module. Next: discounted fuel partners + payment."); return; }
        if(route === "hotels"){ renderStub(t("hotels"), "Demo module. Next: booking API + truck parking filters."); return; }
        if(route === "nearby"){ renderStub(t("nearby"), "Demo module. Next: places API + POI filters."); return; }
      }

      /* ========= Init ========= */
      function buildLangSelect(){
        var sel = $("lang");
        sel.innerHTML = "";
        for (var i=0;i<LANGS.length;i++){
          var l = LANGS[i];
          var opt = document.createElement("option");
          opt.value = l.code;
          opt.textContent = l.label;
          sel.appendChild(opt);
        }

        var saved = safeGet(KEY_LANG);
        var auto = (navigator.language || "uk").toLowerCase();
        auto = auto.indexOf("-") > -1 ? auto.split("-")[0] : auto;
        if(auto === "ua") auto = "uk";

        var initial = saved || auto || "uk";
        var has = LANGS.some(function(x){ return x.code === initial; });
        sel.value = has ? initial : "en";
      }

      function init(){
        buildLangSelect();
        applyTexts();

        var pos = getPos();
        if(pos) $("coord").textContent = pos.lat.toFixed(5)+", "+pos.lng.toFixed(5);

        $("btnMenu").addEventListener("click", openDrawer);
        $("btnClose").addEventListener("click", closeDrawer);
        $("backdrop").addEventListener("click", closeDrawer);

        $all(".navItem").forEach(function(btn){
          btn.addEventListener("click", function(){
            var route = btn.getAttribute("data-route") || "vehicle";
            closeDrawer();
            location.hash = "#"+route;
            render(route);
          });
        });

        $("btnLocate").addEventListener("click", locate);
        $("btnShare").addEventListener("click", shareLink);

        $("lang").addEventListener("change", function(e){
          safeSet(KEY_LANG, e.target.value);
          applyTexts();
          render(getRouteFromHash());
        });

        window.addEventListener("hashchange", function(){
          render(getRouteFromHash());
        });

        $("pillStatus").textContent = "Demo";
        render(getRouteFromHash());
      }

      init();
    })();
  </script>
</body>
</html>
